openapi: 3.0.4
info:
  title: CA-PI - Homologação
  description: 
    "\nEsta API permite que distribuidores realizem pedidos diretamente na plataforma Compra-Agora,\
    \nsem necessidade de acessar o site ou interagir com o front-end.\n\
    \nTodo o processo é automatizado pelo API Gateway, que cuida das etapas críticas: autenticação do distribuidor,\
    \nvalidação dos dados do cliente, montagem do carrinho, aplicação das condições comerciais e finalização do pedido.\n\
    \nA autenticação é feita por meio do padrão OAuth 2.0 – Client Credentials, garantindo segurança e controle no acesso.\
    \nAntes de enviar pedidos, o distribuidor obtém um token de acesso através do endpoint dedicado,\
    \nque deve ser incluído nas requisições subsequentes.\n\
    \nComo se trata de um fluxo assíncrono, a confirmação e o status dos pedidos não são imediatos.\
    \nApós o processamento, o distribuidor recebe essas informações por meio da API de retorno, também incluída\nApós o processamento, o distribuidor recebe essas informações por meio da API de retorno, também incluída neste pacote.\n"    
  
  version: 0.3.0
servers:
- url: https://ams-qas-a2a.test.unilever.apimanagement.eu20.hana.ondemand.com/v1/CABR/BulkOrderServices/Orders
  description: Servidor de (Operação - Homologação)
paths:
  /demand-capture:
    post:
      summary: Recebe pedidos ERP para integração com Compra-Agora.
      security:
      - OAuth2ClientCredentials: []
      tags:
      - Order Request
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - type
              - correlation_id
              - demands
              properties:
                type:
                  type: string
                  maxLength: 25
                  description: Valor fixo "ErpDemandCapture"
                  example: ErpDemandCapture
                correlation_id:
                  type: string
                  maxLength: 255
                  description: ID único para rastreamento ponta-a-ponta da requisição
                  example: AGy9b4x-GjqnkPtyVqUE08oHBZ-test
                demands:
                  type: array
                  description: "Lista de pedidos a serem processados. \n⚠️ Observação:\
                    \ existe uma limitação de até 100 requisições por chamada. \n"
                  items:
                    type: object
                    required:
                    - seller_code
                    - erp_demand_id
                    - cnpj_number
                    - salesman_cpf
                    - payment_term
                    - seller_payment_method
                    - credit_type
                    - items
                    properties:
                      seller_code:
                        type: string
                        maxLength: 10
                        description: Código do seller
                      erp_demand_id:
                        type: string
                        maxLength: 50
                        description: Identificador único do pedido no ERP
                        example: 827-demo123
                      cnpj_number:
                        type: string
                        maxLength: 50
                        description: CNPJ do cliente
                        example: 17.120.206/0001-58
                      salesman_cpf:
                        type: string
                        maxLength: 25
                        description: CPF do vendedor
                        example: 1785694263
                      seller_payment_method:
                        type: string
                        maxLength: 25
                        description: Método de pagamento, sempre “boleto faturado”
                        example: boleto faturado
                      payment_term:
                        type: string
                        maxLength: 50
                        description: Condição de pagamento
                        example: CRL-21_28_35_42_49
                      credit_type:
                        type: string
                        maxLength: 50
                        description: Tipo de crédito, sempre “seller-credit”
                        example: seller-credit
                      ignoreCreditValidation:
                        type: boolean
                        description: "Indica se a validação do limite de crédito deve\
                          \ ser ignorada para este pedido. \n⚠️ Quando definido como\
                          \ true, o sistema não valida o limite de crédito. \nQuando\
                          \ omitido ou false, a validação padrão é aplicada. \n"
                        example: true
                      coupon_code:
                        type: string
                        description: "Código do cupom aplicado. \n⚠️ Observação: Quando\
                          \ não houve cupom deixar o campo em branco. \n"
                        example: ULBR123_456
                      items:
                        type: array
                        description: "Lista de SKUs por pedido a ser processado. \n\
                          ⚠️ Observação: existe uma limitação de até 350 SKUs por\
                          \ pedido. \n"
                        items:
                          type: object
                          required:
                          - sku
                          - quantity
                          properties:
                            sku:
                              type: string
                              description: Código SKU do produto
                              example: 7894000010038C6
                            ean:
                              type: string
                              description: Código produto
                              example: 7894000010039
                            quantity:
                              type: integer
                              description: Quantidade solicitada
                              example: 10
      responses:
        '200':
          description: Pedido recebido com sucesso
        '400':
          description: Requisição inválida
  /order-response:
    post:
      summary: Retorna o status dos pedidos processados pelo Compra-Agora.
      security:
      - OAuth2ClientCredentials: []
      tags:
      - Order Status
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
              - correlation_id
              - type
              - orders
              properties:
                correlation_id:
                  type: string
                  maxLength: 255
                  description: "Tracking ID dos pacotes com pedidos processados. \n\
                    ⚠️ Observação: Processo assíncrono, correlation_id diferente do\
                    \ enviado no Order Request. \n"
                  example: AHx7k9v-LMpnqzXrTwRE91ycVAZ-test
                type:
                  type: string
                  maxLength: 25
                  description: Valor fixo "ErpDemandCapture"
                  example: ErpDemandCapture
                orders:
                  type: array
                  items:
                    type: object
                    required:
                    - seller_code
                    - erp_demand_id
                    - cnpj_number
                    - increment_id
                    - product_success_count
                    - product_failure_count
                    - total_item_count
                    - order_status
                    - coupon_applied_status
                    - items
                    properties:
                      seller_code:
                        type: string
                        maxLength: 10
                        description: Código do seller
                      original_correlation_id:
                        type: string
                        maxLength: 255
                        description: Correlation ID original enviado na Order Request
                      erp_demand_id:
                        type: string
                        maxLength: 50
                        description: "Identificador único do pedido no ERP do Seller.\
                          \ \n⚠️ Observação: Informado na Order Request. \n"
                      cnpj_number:
                        type: string
                        maxLength: 25
                        description: CNPJ do cliente
                      increment_id:
                        type: string
                        maxLength: 50
                        description: ID do pedido gerados.
                      product_success_count:
                        type: integer
                        description: Quantidade de produtos processados com sucesso
                      product_failure_count:
                        type: integer
                        description: Quantidade de produtos com falha
                      total_item_count:
                        type: integer
                        description: Quantidade total de itens no pedido
                      order_error_code:
                        type: string
                        enum:
                        - EC001
                        - EC002
                        - EC003
                        - EC007
                        - EC008
                        - EC009
                        - EC010
                        - EC011
                        description: "Código de erro geral do pedido \n⚠️ Observação:\
                          \ A descrição detalhada dos erros estará disponível na seção\
                          \ de Response. \n"
                      order_status:
                        type: string
                        enum:
                        - success
                        - failed
                        - partial
                        description: Status geral do pedido
                      coupon_applied_status:
                        type: string
                        enum:
                        - success
                        - failed
                        description: Status da aplicação do cupom
                      items:
                        type: array
                        items:
                          type: object
                          required:
                          - sku
                          - status
                          - requested_qty
                          - fulfilled_qty
                          properties:
                            sku:
                              type: string
                              description: SKU do produto
                            status:
                              type: string
                              enum:
                              - success
                              - failed
                              - partial_stock
                              description: Status do processamento do item
                            error_code:
                              type: string
                              enum:
                              - EC004
                              - EC005
                              - EC006
                              description: Código de erro do item, se houver
                            requested_qty:
                              type: integer
                              description: Quantidade de SKUs solicitada.
                            fulfilled_qty:
                              type: integer
                              description: Quantidade de SKUs disponiveis.
      responses:
        default:
          description: "### HTTP Status Codes \n\nCode | Description \n--- | --- \n\
            200 | Retorno recebido com sucesso \n400 | Requisição inválida \n\n###\
            \ Internal Business/Data Errors \n\nCode | Description | Nivel \n--- |\
            \ --- | --- \nEC001 | Falha na autorização do vendedor. Conta incorreta\
            \ ou temporariamente desativada. | Pedido \nEC002 | Falha na autorização\
            \ do cliente. Não foi possível realizar login. | Pedido \nEC003 | Dados\
            \ do cliente não disponíveis. | Pedido \nEC004 | Produto não encontrado:\
            \ {{sku}} | Produto \nEC005 | Falha ao adicionar ao carrinho: quantidade\
            \ indisponível para {{sku}} | Produto \nEC006 | Falha ao adicionar ao\
            \ carrinho: preço não disponível para {{sku}} | Produto \nEC007 | Método\
            \ de pagamento não disponível ou inválido: {{payment_method_code}} | Pedido\
            \ \nEC008 | Cupom não disponível: {{coupon_code}} | Pedido \nEC009 | Falha\
            \ ao finalizar pedido: não foi possível processar o pedido {{seller_order_code}}\
            \ | Pedido \nEC010 | Falha ao criar pedido – Nenhum produto foi incluído\
            \ neste pedido {{sku}} | Pedido \nEC011 | Ordem rejeitada: Limite de crédito\
            \ insuficiente {{credit_limit}} | Pedido \n"
  /OAuth/token:
    post:
      summary: Geração de token (Client Credentials)
      description: Endpoint para emissão de access_token via fluxo Client Credentials.
        Retorna um Bearer token.
      tags:
      - Authentication
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
              - grant_type
              - client_id
              - client_secret
              properties:
                grant_type:
                  type: string
                  enum:
                  - client_credentials
                  example: client_credentials
                client_id:
                  type: string
                client_secret:
                  type: string
      responses:
        '200':
          description: Token gerado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokenResponse'
        '400':
          description: Parâmetros inválidos
        '401':
          description: Credenciais inválidas
components:
  securitySchemes:
    OAuth2ClientCredentials:
      type: oauth2
      description: Ambiente de Autenticação fornecida pelo Compra-Agora.
      flows:
        clientCredentials:
          tokenUrl: https://ams-qas-a2a.test.unilever.apimanagement.eu20.hana.ondemand.com/OAuth/token
          scopes: {}
  schemas:
    AuthTokenResponse:
      type: object
      properties:
        refresh_token_expires_in:
          type: string
        api_product_list:
          type: string
        api_product_list_json:
          type: array
          items:
            type: string
        organization_name:
          type: string
        developer.email:
          type: string
          format: email
        token_type:
          type: string
        issued_at:
          type: string
        client_id:
          type: string
        access_token:
          type: string
        application_name:
          type: string
        scope:
          type: string
        expires_in:
          type: string
        refresh_count:
          type: string
        status:
          type: string
      example:
        refresh_token_expires_in: '0'
        api_product_list: '[Magento_ERP_API_Product]'
        api_product_list_json:
        - Magento_ERP_API_Product
        organization_name: ams-qas-a2a
        developer.email: dev@example.com
        token_type: BearerToken
        issued_at: '1765995962286'
        client_id: '********-client-id-redacted'
        access_token: '***redacted***'
        application_name: 8091d674-43b9-49a4-aae2-4ef5d2cc7b02
        scope: ''
        expires_in: '1799'
        refresh_count: '0'
        status: approved
